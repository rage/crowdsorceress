language: ruby
cache: bundler
sudo: required
rvm:
  - 2.4.1
# Handle git submodules yourself
git:
  submodules: false
# Use sed to replace the SSH URL with the public URL, then initialize submodules
before_install:
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - git submodule update --init --recursive
env:
  global:
    - RAILS_ENV=test
services:
  - docker
script:
  - docker-compose build
  - docker-compose run --service-ports web env RAILS_ENV=test bin/rails db:create db:migrate
  - docker-compose run --service-ports web env RAILS_ENV=test bin/rails spec
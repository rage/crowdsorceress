language: ruby
cache: bundler
sudo: required
rvm:
  - 2.4.1
git:
  submodules: false
before_install:
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - git submodule update --init --recursive
env:
  global:
    - RAILS_ENV=test
services:
  - docker
before_script:
  - docker-compose run --service-ports web bin/rails db:create db:migrate
script:
  - docker-compose run --service-ports web bin/rails spec
install:
  - docker-compose build